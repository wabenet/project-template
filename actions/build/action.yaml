---
name: 'Build'
description: 'Builds the code and optionally creates a release on Github'

inputs:
  release:
    description: 'Create a Github release from the build'
    default: false
  github-token:
    description: 'Github Token for authentication'

runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v4

    - name: Build
      uses: docker://wabenet/wabe-project-build@${{ github.action_ref }}
      if: ${{ inputs.release == false || inputs.release == 'false' }}
      with:
        entrypoint: make
        args: test build

    - name: Release
      uses: docker://wabenet/wabe-project-build@${{ github.action_ref }}
      if: ${{ inputs.release == true || inputs.release == 'true' }}
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
      with:
        entrypoint: make
        args: release
