---
name: 'Tests and Code Coverage'
description: 'Runs tests and uploads the coverage reports to CodeClimate and Codecov'

inputs:
  cc-reporter-id:
    description: 'CodeClimate test reporter ID'
    required: true

runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 2

    - name: Run test coverage
      uses: docker://wabenet/wabe-project-build@${{ github.action_ref }}
      env:
        CC_TEST_REPORTER_ID: ${{ inputs.cc-reporter-id }}
      with:
        entrypoint: make
        args: coverage-report

    - name: Upload to codecov
      uses: codecov/codecov-action@v5

    - name: Run linters
      uses: docker://wabenet/wabe-project-build@${{ github.action_ref }}
      with:
        entrypoint: make
        args: lint

